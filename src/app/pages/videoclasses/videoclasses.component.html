<h1>Videolezioni dove e quando vuoi</h1>
<p>
  Qui troverai delle videolezioni registrate, che ti forniranno le basi per
  poter segnare.
</p>
@if(videoPresentation && !paymentSuccess){
<p>
  Se desideri, invece, prendere lezioni in presenza, clicca
  <a [routerLink]="['/lessons']">qui</a>
</p>

<nz-card *ngIf="videoPresentation" nzTitle="Introduzione">
  <div class="video-container">
    <video
      #introVideo
      [src]="videoPresentation.videoClassUrl"
      width="100%"
      height="auto"
      controls
    >
      Il tuo browser non supporta il tag video.
    </video>
  </div>

  <div class="video-info">
    <h3>{{ videoPresentation.title }}</h3>
    <p>{{ videoPresentation.description }}</p>
  </div>
</nz-card>
}
<h3>Ti abbiamo conquistato?</h3>
<p>Acquista il nostro corso, al costo di 50 euro</p>

<button nz-button nzType="primary" (click)="togglePaymentForm()">
  {{ showPaymentForm ? "Nascondi Pagamento" : "Acquista" }}
</button>

@if(showPaymentForm){
<form [formGroup]="paymentForm" (ngSubmit)="submitPayment()">
  <div>
    <label>Nome intestario Carta</label>
    <input formControlName="cardHolderName" type="text" required />
    <span
      *ngIf="
        paymentForm.get('cardHolderName')?.invalid &&
        paymentForm.get('cardHolderName')?.touched
      "
    >
      ⚠️ Il nome è obbligatorio
    </span>
  </div>

  <div>
    <label>Numero Carta</label>
    <input formControlName="cardNumber" type="text" maxlength="16" required />
    <span
      *ngIf="
        paymentForm.get('cardNumber')?.invalid &&
        paymentForm.get('cardNumber')?.touched
      "
    >
      ⚠️ Inserisci un numero di carta valido (16 cifre)
    </span>
  </div>

  <div>
    <label>Scadenza (MM/YY)</label>
    <input
      formControlName="expirationDate"
      type="text"
      maxlength="5"
      required
    />
    <span
      *ngIf="
        paymentForm.get('expirationDate')?.invalid &&
        paymentForm.get('expirationDate')?.touched
      "
    >
      ⚠️ Inserisci una data valida (MM/YY)
    </span>
  </div>

  <div>
    <label>CVV</label>
    <input formControlName="cvv" type="text" maxlength="4" required />
    <span
      *ngIf="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched"
    >
      ⚠️ Inserisci un CVV valido (3 o 4 cifre)
    </span>
  </div>

  <div>
    <label>Tipo di Carta</label>
    <select formControlName="type">
      <option value="CREDIT">Carta di Credito</option>
      <option value="DEBIT">Carta di Debito</option>
      <option value="PAYPAL">PayPal</option>
    </select>
  </div>

  <button type="submit" [disabled]="paymentForm.invalid">
    Aggiungi Metodo
  </button>
</form>
}
<!-- Messaggio di successo -->
<div *ngIf="paymentSuccess">
  <p style="color: green">✅ Pagamento effettuato con successo!</p>
</div>

@if(paymentSuccess){
<div class="carousel-container">
  <nz-carousel [nzEffect]="strategy" *ngIf="videoClasses.length > 0">
    @for (index of array; track index) {
    <div nz-carousel-content *ngFor="let videoClass of videoClasses">
      <div class="video-card">
        <!-- Video con pulsante Play/Pausa -->
        <div class="video-container">
          <video
            #videoPlayer
            [src]="videoClass.videoClassUrl"
            width="320"
            height="180"
            controls
          >
            Il tuo browser non supporta il tag video.
          </video>
        </div>

        <!-- Titolo e descrizione -->
        <div class="video-info">
          <h3>
            <span class="input">Titolo: </span>
            <span class="value">{{ videoClass.title }}</span>
          </h3>
          <p>
            <span class="input"> Descrizione: </span>
            <span class="value">{{ videoClass.description }} </span>
          </p>
        </div>

        <!-- Pulsanti -->
        <div class="buttons">
          <button
            type="button"
            (click)="togglePlay(videoPlayer)"
            class="play-button"
          >
            {{ isPlaying ? "⏸️" : "▶️" }}
          </button>
          ì
        </div>
      </div>
    </div>
    }
  </nz-carousel>
</div>
}
